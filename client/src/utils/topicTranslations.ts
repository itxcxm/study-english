/**
 * ğŸ‡»ğŸ‡³ Báº£n Ä‘á»“ dá»‹ch cÃ¡c tÃªn chá»§ Ä‘á» tá»« tiáº¿ng Anh sang tiáº¿ng Viá»‡t
 * ğŸ‡»ğŸ‡³ Sá»­ dá»¥ng Ä‘á»ƒ hiá»ƒn thá»‹ tÃªn chá»§ Ä‘á» báº±ng tiáº¿ng Viá»‡t cho ngÆ°á»i dÃ¹ng
 */
export const topicTranslations: Record<string, string> = {
  // CÃ¡c thÃ¬ Ä‘á»™ng tá»« (Verb Tenses)
  'PresentSimple': 'Hiá»‡n táº¡i Ä‘Æ¡n',
  'PresentContinuous': 'Hiá»‡n táº¡i tiáº¿p diá»…n',
  'PresentPerfect': 'Hiá»‡n táº¡i hoÃ n thÃ nh',
  'PresentPerfectContinuous': 'Hiá»‡n táº¡i hoÃ n thÃ nh tiáº¿p diá»…n',
  'PastSimple': 'QuÃ¡ khá»© Ä‘Æ¡n',
  'PastContinuous': 'QuÃ¡ khá»© tiáº¿p diá»…n',
  'PastPerfect': 'QuÃ¡ khá»© hoÃ n thÃ nh',
  'PastPerfectContinuous': 'QuÃ¡ khá»© hoÃ n thÃ nh tiáº¿p diá»…n',
  'FutureSimple': 'TÆ°Æ¡ng lai Ä‘Æ¡n',
  'FutureContinuous': 'TÆ°Æ¡ng lai tiáº¿p diá»…n',
  'FuturePerfect': 'TÆ°Æ¡ng lai hoÃ n thÃ nh',
  'FuturePerfectContinuous': 'TÆ°Æ¡ng lai hoÃ n thÃ nh tiáº¿p diá»…n',
  'OtherVerbTenses': 'CÃ¡c thÃ¬ Ä‘á»™ng tá»« khÃ¡c',
  
  // Ngá»¯ phÃ¡p (Grammar)
  'Articles': 'Máº¡o tá»«',
  'Nouns': 'Danh tá»«',
  'Pronouns': 'Äáº¡i tá»«',
  'Adjectives': 'TÃ­nh tá»«',
  'Adverbs': 'Tráº¡ng tá»«',
  'Verbs': 'Äá»™ng tá»«',
  'Prepositions': 'Giá»›i tá»«',
  'Conjunctions': 'LiÃªn tá»«',
  'Conditionals': 'CÃ¢u Ä‘iá»u kiá»‡n',
  'PassiveVoice': 'Bá»‹ Ä‘á»™ng',
  'ReportedSpeech': 'CÃ¢u tÆ°á»ng thuáº­t',
  'RelativeClauses': 'Má»‡nh Ä‘á» quan há»‡',
  'NounClauses': 'Má»‡nh Ä‘á» danh tá»«',
  'AdverbialClauses': 'Má»‡nh Ä‘á» tráº¡ng ngá»¯',
  'CleftSentences': 'CÃ¢u cháº»',
  'Comparisons': 'So sÃ¡nh',
  'Emphasis': 'Nháº¥n máº¡nh',
  'Existential': 'Tá»“n táº¡i',
  'Inversion': 'Äáº£o ngá»¯',
  'Negation': 'Phá»§ Ä‘á»‹nh',
  'Questions': 'CÃ¢u há»i',
  'Subjunctive': 'Giáº£ Ä‘á»‹nh',
  'UsedTo': 'Used to',
  'WishIfOnly': 'Wish/If only',
  
  // Chá»§ Ä‘á» tá»« vá»±ng (Vocabulary Topics)
  'Animals': 'Äá»™ng váº­t',
  'Colors': 'MÃ u sáº¯c',
  'Jobs': 'Nghá» nghiá»‡p',
  'Relationships': 'Quan há»‡',
  'Time': 'Thá»i gian',
  'Weather': 'Thá»i tiáº¿t',
  'DatesSeasons': 'NgÃ y thÃ¡ng & MÃ¹a',
  'House': 'NhÃ  cá»­a',
  'Transportation': 'PhÆ°Æ¡ng tiá»‡n giao thÃ´ng',
  'SchoolSupplies': 'Äá»“ dÃ¹ng há»c táº­p',
  'Clothing': 'Quáº§n Ã¡o',
  'Education': 'GiÃ¡o dá»¥c',
  'Emotions': 'Cáº£m xÃºc',
  'FoodDrinks': 'Thá»©c Äƒn & Äá»“ uá»‘ng',
  'Health': 'Sá»©c khá»e',
  'Numbers': 'Sá»‘ Ä‘áº¿m',
  'Sports': 'Thá»ƒ thao',
  'ArtMusic': 'Nghá»‡ thuáº­t & Ã‚m nháº¡c',
  'VegetablesFruits': 'Rau cá»§ & TrÃ¡i cÃ¢y',
  'Entertainment': 'Giáº£i trÃ­',
  'Technology': 'CÃ´ng nghá»‡',
  'Festivals': 'Lá»… há»™i',
  'Nature': 'ThiÃªn nhiÃªn',
  'OtherVocabulary': 'Tá»« vá»±ng khÃ¡c',
  'Places': 'Äá»‹a Ä‘iá»ƒm',
  'ShoppingMoney': 'Mua sáº¯m & Tiá»n báº¡c',
  'Travel': 'Du lá»‹ch',
  'Shapes': 'HÃ¬nh dáº¡ng',
  'Family': 'Gia Ä‘Ã¬nh',
  'PlantsFlowers': 'CÃ¢y cá»‘i & Hoa',
  'VerbsActions': 'Äá»™ng tá»« & HÃ nh Ä‘á»™ng',
};

/**
 * ğŸ‡»ğŸ‡³ HÃ m chuyá»ƒn chá»§ Ä‘á» tá»« dáº¡ng URL (kebab-case) sang dáº¡ng PascalCase theo server
 * ğŸ‡»ğŸ‡³ Äáº£m báº£o tÃªn chá»§ Ä‘á» khá»›p vá»›i format Ä‘Æ°á»£c sá»­ dá»¥ng trong backend
 * @param topic - TÃªn chá»§ Ä‘á» á»Ÿ dáº¡ng kebab-case hoáº·c snake_case
 * @returns TÃªn chá»§ Ä‘á» Ä‘Ã£ Ä‘Æ°á»£c chuáº©n hÃ³a sang PascalCase
 */
export function normalizeTopicKey(topic: string): string {
  if (!topic) return topic;

  // ğŸ‡»ğŸ‡³ HÃ m helper: Chuyá»ƒn tá»« kebab-case/snake_case sang PascalCase
  const toPascal = (s: string) =>
    s
      .split(/[-_\s]+/)
      .filter(Boolean)
      .map((w) => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase())
      .join("");

  // ğŸ‡»ğŸ‡³ Äá»‘i chiáº¿u cÃ¡c trÆ°á»ng há»£p Ä‘áº·c biá»‡t cho tÃªn ghÃ©p (cÃ¡c tá»« cÃ³ dáº¥u gáº¡ch ngang)
  const specialCases: Record<string, string> = {
    "dates-seasons": "DatesSeasons",
    "food-drinks": "FoodDrinks",
    "vegetables-fruits": "VegetablesFruits",
    "school-supplies": "SchoolSupplies",
    "passive-voice": "PassiveVoice",
    "reported-speech": "ReportedSpeech",
    "relative-clauses": "RelativeClauses",
    "noun-clauses": "NounClauses",
    "adverbial-clauses": "AdverbialClauses",
    "cleft-sentences": "CleftSentences",
    "used-to": "UsedTo",
    "wish-if-only": "WishIfOnly",
    "present-simple": "PresentSimple",
    "present-continuous": "PresentContinuous",
    "present-perfect": "PresentPerfect",
    "present-perfect-continuous": "PresentPerfectContinuous",
    "past-simple": "PastSimple",
    "past-continuous": "PastContinuous",
    "past-perfect": "PastPerfect",
    "past-perfect-continuous": "PastPerfectContinuous",
    "future-simple": "FutureSimple",
    "future-continuous": "FutureContinuous",
    "future-perfect": "FuturePerfect",
    "future-perfect-continuous": "FuturePerfectContinuous",
    "other-verbenses": "OtherVerbTenses",
    "otherverbenses": "OtherVerbTenses",
    "other-vocabulary": "OtherVocabulary",
    "other-grammar": "OtherGrammar",
    "plants-flowers": "PlantsFlowers",
    "shopping-money": "ShoppingMoney",
    "art-music": "ArtMusic",
    "verbs-actions": "VerbsActions",
  };

  // ğŸ‡»ğŸ‡³ Æ¯u tiÃªn kiá»ƒm tra trÆ°á»ng há»£p Ä‘áº·c biá»‡t trÆ°á»›c
  if (specialCases[topic.toLowerCase()]) {
    return specialCases[topic.toLowerCase()];
  }

  // ğŸ‡»ğŸ‡³ Kiá»ƒm tra khá»›p trá»±c tiáº¿p (Ä‘Ã£ lÃ  PascalCase)
  if (topicTranslations[topic]) return topic;

  // ğŸ‡»ğŸ‡³ Chuyá»ƒn sang PascalCase vÃ  kiá»ƒm tra láº¡i
  const pascalKey = toPascal(topic);
  if (topicTranslations[pascalKey]) return pascalKey;

  // ğŸ‡»ğŸ‡³ KhÃ´ng khá»›p thÃ¬ tráº£ láº¡i phiÃªn báº£n PascalCase
  return pascalKey || topic;
}

/**
 * ğŸ‡»ğŸ‡³ HÃ m dá»‹ch tÃªn chá»§ Ä‘á» sang tiáº¿ng Viá»‡t
 * ğŸ‡»ğŸ‡³ Há»— trá»£ nhiá»u Ä‘á»‹nh dáº¡ng Ä‘áº§u vÃ o (PascalCase, kebab-case, snake_case, v.v.)
 * @param topic - TÃªn chá»§ Ä‘á» cáº§n dá»‹ch (cÃ³ thá»ƒ á»Ÿ nhiá»u Ä‘á»‹nh dáº¡ng khÃ¡c nhau)
 * @returns TÃªn chá»§ Ä‘á» Ä‘Ã£ Ä‘Æ°á»£c dá»‹ch sang tiáº¿ng Viá»‡t, hoáº·c tráº£ vá» nguyÃªn báº£n náº¿u khÃ´ng tÃ¬m tháº¥y
 */
export function translateTopic(topic: string): string {
  if (!topic) return topic;

  // ğŸ‡»ğŸ‡³ 1) So khá»›p trá»±c tiáº¿p vá»›i key trong báº£n Ä‘á»“ dá»‹ch
  if (topicTranslations[topic]) return topicTranslations[topic];

  // ğŸ‡»ğŸ‡³ 2) So khá»›p khÃ´ng phÃ¢n biá»‡t hoa thÆ°á»ng vá»›i key
  const directKey = Object.keys(topicTranslations).find(
    (k) => k.toLowerCase() === topic.toLowerCase()
  );
  if (directKey) return topicTranslations[directKey];

  // ğŸ‡»ğŸ‡³ 3) Chuáº©n hoÃ¡ cÃ¡c trÆ°á»ng há»£p chá»§ Ä‘á» thÆ°á»ng gáº·p tá»« URL sang PascalCase trong map
  const toPascal = (s: string) =>
    s
      .split(/[-_\s]+/)
      .filter(Boolean)
      .map((w) => w.charAt(0).toUpperCase() + w.slice(1))
      .join("");

  const pascalKey = toPascal(topic);
  if (topicTranslations[pascalKey]) return topicTranslations[pascalKey];

  // ğŸ‡»ğŸ‡³ 4) Thá»­ loáº¡i bá» dáº¥u phÃ¢n cÃ¡ch vÃ  viáº¿t hoa chá»¯ cÃ¡i Ä‘áº§u, kiá»ƒm tra láº¡i
  const compact = topic.replace(/[-_\s]+/g, "");
  const compactPascal = compact.charAt(0).toUpperCase() + compact.slice(1);
  if (topicTranslations[compactPascal]) return topicTranslations[compactPascal];

  // ğŸ‡»ğŸ‡³ 5) KhÃ´ng tÃ¬m tháº¥y: tráº£ vá» nguyÃªn báº£n
  return topic;
}

